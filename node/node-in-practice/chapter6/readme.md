# 文件系统

## fs 模块以及其组件

## 使用配置文件以及文件描述

- 什么是文件描述符？
  首先，系统内核会为所有进程维护一张当前打开的所有文件和资源的表格。
  每个打开的文件都会分配一个名为“文件描述符”的数值标识。
  在系统层，所有的文件系统操作，都会使用这些文件标识符来指定特定的文件。
  在 window 下，会使用不同但概念类似的机制来追踪文件和资源。
  node 抽象了不同系统之间的差异，为所有打开的文件分配和数值的文件描述符。

## 文件锁技术

- 使用独占创建锁文件
- 通过 mkdir 创建锁文件

## 递归文件操作

- 关于同步和异步的递归文件操作
  **问题：** 如果对目录结构的文件进行递归操作？从哪个地方开始？
  fs 模块提供了我们需要的基本的方法。

  1. fs.readdir/readdirSync 通过地址参数，列出包括目录的所有文件
  2. fs.stat/fs.statSync 返回指定路径的文件信息，无论该路径是目录还是文件

  **问题：**同步的方法会比异步的快？

  > 同步的方法不会异步执行，就算相对的异步方法执行很快，当 CPU 准备妥当时，同步方法会立即执行，会保证你只需要等待必要的 I/O 完成。
  > 但是，同步的方法在运行期间会堵塞，碰到大的目录结构是会执行失败(栈溢出)。同步的方法虽然会慢些，但不会失败(栈会逐步清除)，且不会堵塞进程。

  使用异步递归时，应该使用一个计数器来跟踪一组异步操作是否完成。例如，调用 readdir 方法时，会进入了一个异步回调，此时计数器则+1,当回调执行完成后，计数器-1。当计数为 0 时，即为所有异步操作 完成的时候。

## 编写文件数据库

## 监听文件及文件夹

- fs.watch

特征：

1. 一个更可靠的实现，使得文件改变的事件能够总是被执行
2. 一个更快的实现，当事件发生时，能够立即通知到 Node 进程

缺点：不跨平台

- fs.watchFile

没有渗入到通知系统，而是砸死一个时间段内不停地轮询来看是否文件有变化
监听一个目录时，许多对文件的更新不会被 fs.wathcFile 监听到
优势: 跨平台
