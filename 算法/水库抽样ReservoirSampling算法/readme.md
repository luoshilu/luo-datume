# 蓄水池问题

输入：一组数据，其大小未知
输出：这组数据的k个均匀抽样

要求：
仅扫描数据一次。
空间复杂度为O(K)。空间复杂度与整个数据量无关，只与抽样大小有关。
扫描到数据的前n 个数据时（n>k）,保存当前已扫描数据的k个均匀抽样。

问题可以理解为：蓄水池（水库）的容量为k，对于n（n>k）个元素，如果第i个元素（i从1逐渐递增至n）以k/i的概率决定是否将它放入蓄水池，当i=n时，蓄水池中存放的是n个元素的均匀抽样，每个数字最终被存在数组中的概率相等，为k/n。证明如下。


**证明:**

    １　~　k ... i . i+1 ...n
* 假设：i被选中进入水库的概率为: k/i。
* 入库的i被i+1替换的概率　＝　i+1被选中入库的概率(k/(i+1)) x 入库的i被替换的概率(1/k) = 1/i+1;
* 遍历i+1后i存在水库的概率　＝　i被选中(k/i) x i未被i+1替换(1 - (1/(i+1)));
* 所以遍历完n后i还存在水库的概率 = i被选中 x 遍历i+1后i存在水库的概率 x 遍历i+2后i存在水库的概率 x....x 遍历n后i存在水库的概率
= k/i x (1-1/(i+1)) x (1-1/(i+2)) x ... x (1-1/n)
= k/n

## javascript代码实例

    // 从０～max 随机取k个不重复的数
    function samp(max, k)
    {
        var ary = [];
        for(var i=1;i <= k;i++)
        {
            ary.push(i);
        }

        for(var i=k+1;i <= max;i++)
        {
            // 以 k/i的概率选择是否替换
            if(Math.ceil(Math.random()*i) <= k)
            {
                // 数组中的随机一个值的下标
                var index = Math.floor(Math.random()*(k));
                // 替换
                ary[index] = i;
            }
        }
        return ary;
    }